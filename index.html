<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Pet Peeves ‚Äì Morgan</title>

<style>
:root{
  --bg:#0b1424;
  --panel:#121f35;
  --ink:#eaf1ff;
  --muted:rgba(234,241,255,.75);
  --line:rgba(255,255,255,.08);
  --good:#5cffad;
  --bad:#ff6b6b;
  --caution:#ffd166;
}
*{box-sizing:border-box}
body{
  margin:0;
  padding:20px;
  font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
  background:var(--bg);
  color:var(--ink);
}
h1{text-align:center;margin:10px 0 20px}
.tabs{display:flex;gap:10px;flex-wrap:wrap;justify-content:center;margin-bottom:20px}
.tabBtn{
  padding:10px 16px;
  border:none;
  border-radius:999px;
  background:#1c2a44;
  color:white;
  cursor:pointer;
  font-weight:700;
}
.tabBtn.active{background:#2f6df6}
.card{
  max-width:950px;
  margin:0 auto 20px;
  background:var(--panel);
  padding:20px;
  border-radius:16px;
  border:1px solid var(--line);
}
textarea,input,select{
  width:100%;
  padding:12px;
  border-radius:12px;
  border:1px solid var(--line);
  background:#0f1b2f;
  color:white;
  margin-top:6px;
  font-size:16px;
}
textarea{min-height:120px}
.btnRow{display:flex;gap:10px;flex-wrap:wrap;margin-top:12px}
.btn{
  padding:10px 14px;
  border:none;
  border-radius:12px;
  cursor:pointer;
  font-weight:800;
  background:#1f2f4a;
  color:white;
}
.btn.primary{background:#2f6df6}
.pill{
  padding:5px 10px;
  border-radius:999px;
  font-size:12px;
  font-weight:800;
  border:1px solid var(--line);
}
.good{color:var(--good)}
.bad{color:var(--bad)}
.caution{color:var(--caution)}
.result{
  margin-top:12px;
  padding:12px;
  border-radius:12px;
  border:1px solid var(--line);
  background:#0f1b2f;
}
.muted{color:var(--muted);font-size:13px}
.divider{height:1px;background:var(--line);margin:15px 0}
.savedBox{
  border:1px solid var(--line);
  border-radius:12px;
  padding:10px;
  margin-top:10px;
  white-space:pre-wrap;
  font-family:monospace;
}
</style>
</head>

<body>
<h1>üêæ Pet Peeves ‚Äì Morgan</h1>

<div class="tabs">
  <button class="tabBtn active" id="tab-scanner" onclick="showTab('scanner')">Scanner</button>
  <button class="tabBtn" id="tab-meal" onclick="showTab('meal')">Meal Planner</button>
  <button class="tabBtn" id="tab-saved" onclick="showTab('saved')">Saved Meals</button>
  <button class="tabBtn" id="tab-lists" onclick="showTab('lists')">Lists</button>
</div>

<!-- SCANNER -->
<div id="scanner" class="card">
<h2>Ingredient Scanner</h2>
<div class="muted">Scans food + additives together. Handles plurals and ignores parenthesis notes from photos.</div>

<textarea id="scanInput" placeholder="Paste ingredients here"></textarea>

<div class="btnRow">
<button class="btn primary" onclick="scanAll()">Scan</button>
<button class="btn" onclick="demoScan()">Demo</button>
<button class="btn" onclick="clearScan()">Clear</button>
</div>

<div id="scanResults"></div>
</div>

<!-- MEAL -->
<div id="meal" class="card" style="display:none">
<h2>Meal Planner</h2>
<div class="muted">Filters out Morgan‚Äôs Moderate/High foods automatically.</div>

<label>Morgan weight (lbs)</label>
<input id="morganWeight" type="number" value="55" />

<label>Activity % bodyweight per day</label>
<input id="activityPct" type="range" min="1.5" max="4" step="0.1" value="2.5">
<div class="muted"><span id="pctLabel">2.5%</span></div>

<label>Meals per day</label>
<select id="mealsPerDay">
<option value="1">1</option>
<option value="2" selected>2</option>
<option value="3">3</option>
</select>

<label>Batch days</label>
<input id="batchDays" type="range" min="1" max="7" value="7">
<div class="muted"><span id="batchLabel">7 days</span></div>

<label>Liquid display</label>
<select id="liquidUnit">
<option value="fl_oz" selected>fl oz</option>
<option value="cups">cups</option>
</select>

<div class="btnRow">
<button class="btn primary" onclick="generateMeal()">Generate</button>
<button class="btn" onclick="saveMeal()">Save</button>
<button class="btn" onclick="exportGrocery()">Export Grocery</button>
</div>

<div id="mealOutput"></div>
</div>

<!-- SAVED -->
<div id="saved" class="card" style="display:none">
<h2>Saved Meals</h2>
<div id="savedMeals"></div>
</div>

<!-- LISTS -->
<div id="lists" class="card" style="display:none">
<h2>Morgan Reactivity Lists</h2>
<div id="listsContent"></div>
</div>

<script>
/* =====================
   DATA
===================== */

const DATA={
food:{
high:[
"bacon","carrot","cheese - cheddar","cheese - cottage","durian","fermented pork","flaxseed",
"ginkgo biloba","mackerel","milk - cow","ocean fish meal","pepper - green","pig skin",
"pine nut","pork","pork fat","pork heart","pork kidney","pork liver","pork skins",
"pork tongue","soy flour","tofu","yogurt (plain)"
],
moderate:[
"alfalfa nutrient concentrate","anchovy","brussels sprouts","chestnut",
"chokeberry (aronia berry)","coconut","cranberries","cream","elk","figs",
"grapefruit","grouse","okra","olive oil","pepper - white","pig trotters",
"rice (white)","roe - deer","salmon","scarlet runner bean","teff (vegan)",
"trout","turkey heart"
]
},
additives:{
high:[
"e 129 allura red","e 170 calcium carbonate","e 172 iron oxides",
"e 234 nisin","e 304 ascorbyl palmitate","e 463 hydroxypropyl cellulose",
"e 472 d tartaric acid esters","e 475 polyglycerol esters",
"e 512 stannous chloride","e 629 calcium guanylate",
"e 938 argon","e 941 nitrogen","formalin"
],
moderate:[
"e 110 sunset yellow","e 151 brilliant black","e 203 calcium sorbate",
"e 221 sodium sulphite","e 233 thiabendazole","e 326 potassium lactate",
"e 336 potassium tartrate","e 338 phosphoric acid","e 460 cellulose",
"e 495 sorbitan monopalmitate","e 514 sodium sulphate",
"e 541 sodium aluminium phosphate","e 585 ferrous lactate",
"e 952 cyclamic acid","e 953 isomalt","e 966 lactitol","polyethylene glycol"
]
}
};

/* =====================
   UTILITIES
===================== */

function norm(s){
return (s||"").toLowerCase()
.replace(/\([^)]*\)/g,"")
.replace(/ingredients\s*:/i,"")
.replace(/[^a-z0-9\s\-]/g," ")
.replace(/\s+/g," ")
.trim();
}

function pluralFix(word){
if(word.endsWith("ies")) return word.slice(0,-3)+"y";
if(word.endsWith("s")&&!word.endsWith("ss")) return word.slice(0,-1);
return word;
}

function keyify(s){
return norm(s).split(" ").map(pluralFix).join(" ");
}

function severity(item){
const k=keyify(item);
if(DATA.food.high.includes(k)) return "High";
if(DATA.food.moderate.includes(k)) return "Moderate";
if(DATA.additives.high.includes(k)) return "High Additive";
if(DATA.additives.moderate.includes(k)) return "Moderate Additive";
return null;
}

/* =====================
   SCANNER
===================== */

function scanAll(){
const items=document.getElementById("scanInput").value
.split(/[\n,;]+/).map(x=>x.trim()).filter(Boolean);

let html="";
items.forEach(i=>{
const sev=severity(i);
if(sev){
html+=`<div class="result bad">
<b>${i}</b> ‚Äî NOT SAFE for Morgan
<div class="muted">${sev}</div>
</div>`;
}else{
html+=`<div class="result good">
<b>${i}</b> ‚Äî SAFE
</div>`;
}
});
document.getElementById("scanResults").innerHTML=html||"<div class='result muted'>Nothing scanned.</div>";
}

function demoScan(){
document.getElementById("scanInput").value=
"Chicken\nCarrots\nRice (white)\nBone broth\nE 221 sodium sulphite";
scanAll();
}
function clearScan(){
document.getElementById("scanInput").value="";
document.getElementById("scanResults").innerHTML="";
}

/* =====================
   MEAL PLANNER
===================== */

const LIB={
proteins:["chicken","turkey","duck","lamb","bison","venison","beef"],
carbs:["rice (brown)","quinoa","oats","barley","pumpkin"],
veg:["zucchini","green beans","spinach","broccoli","peas"],
fats:["fish oil","salmon oil","sunflower oil"],
flavor:["pumpkin puree","bone broth","blueberries","apple","parsley"]
};

function isBanned(food){
return DATA.food.high.includes(food)||DATA.food.moderate.includes(food);
}

function safePool(arr){
return arr.filter(x=>!isBanned(x));
}

function ozToCups(oz){return oz/4;}
function fmtLbsOz(oz){
const lbs=Math.floor(oz/16);
const r=oz-lbs*16;
if(lbs<=0) return r.toFixed(1)+" oz";
return lbs+" lb "+r.toFixed(1)+" oz";
}

let LAST_MEAL=null;

function generateMeal(){
const lbs=parseFloat(document.getElementById("morganWeight").value||"0");
const pct=parseFloat(document.getElementById("activityPct").value)/100;
const meals=parseInt(document.getElementById("mealsPerDay").value);
const days=parseInt(document.getElementById("batchDays").value);

if(!lbs) return;

const dailyOz=lbs*pct*16;
const perMeal=dailyOz/meals;
const batch=dailyOz*days;

const protein=safePool(LIB.proteins)[0]||"chicken";
const carb=safePool(LIB.carbs)[0]||"rice (brown)";
const veg=safePool(LIB.veg)[0]||"green beans";
const fat=safePool(LIB.fats)[0]||"fish oil";
const flavor=safePool(LIB.flavor)[0]||"pumpkin puree";

LAST_MEAL={protein,carb,veg,fat,flavor,batch,dailyOz,perMeal,days};

document.getElementById("mealOutput").innerHTML=`
<div class="result good">
<b>Protein:</b> ${protein}<br>
<b>Carb:</b> ${carb}<br>
<b>Veg:</b> ${veg}<br>
<b>Fat:</b> ${fat}<br>
<b>Flavor:</b> ${flavor}
<div class="divider"></div>
<b>Daily:</b> ${fmtLbsOz(dailyOz)} (~${ozToCups(dailyOz).toFixed(2)} cups)<br>
<b>Per meal:</b> ${fmtLbsOz(perMeal)} (~${ozToCups(perMeal).toFixed(2)} cups)<br>
<b>Batch total (${days} days):</b> ${fmtLbsOz(batch)}
</div>`;
}

/* =====================
   SAVE + EXPORT
===================== */

function saveMeal(){
if(!LAST_MEAL) return alert("Generate meal first.");
const arr=JSON.parse(localStorage.getItem("morganMeals")||"[]");
arr.unshift(LAST_MEAL);
localStorage.setItem("morganMeals",JSON.stringify(arr));
renderSaved();
}

function renderSaved(){
const arr=JSON.parse(localStorage.getItem("morganMeals")||"[]");
if(!arr.length){
document.getElementById("savedMeals").innerHTML="<div class='muted'>No saved meals.</div>";
return;
}
let html="";
arr.forEach(m=>{
html+=`
<div class="savedBox">
Protein: ${m.protein}
Carb: ${m.carb}
Veg: ${m.veg}
Fat: ${m.fat}
Flavor: ${m.flavor}

Daily: ${fmtLbsOz(m.dailyOz)}
Batch: ${fmtLbsOz(m.batch)} (${m.days} days)
</div>`;
});
document.getElementById("savedMeals").innerHTML=html;
}

function exportGrocery(){
if(!LAST_MEAL) return alert("Generate meal first.");
const txt=`
Morgan Grocery List

Protein: ${LAST_MEAL.protein}
Carb: ${LAST_MEAL.carb}
Veg: ${LAST_MEAL.veg}
Fat: ${LAST_MEAL.fat}
Flavor: ${LAST_MEAL.flavor}

Batch Total: ${fmtLbsOz(LAST_MEAL.batch)}
`;
navigator.clipboard.writeText(txt).then(()=>alert("Copied grocery list"));
}

/* =====================
   LISTS
===================== */

function renderLists(){
document.getElementById("listsContent").innerHTML=`
<b>High Food:</b><br>${DATA.food.high.join(", ")}<br><br>
<b>Moderate Food:</b><br>${DATA.food.moderate.join(", ")}<br><br>
<b>High Additives:</b><br>${DATA.additives.high.join(", ")}<br><br>
<b>Moderate Additives:</b><br>${DATA.additives.moderate.join(", ")}
`;
}

/* =====================
   TABS
===================== */

function showTab(tab){
["scanner","meal","saved","lists"].forEach(t=>{
document.getElementById(t).style.display=(t===tab)?"block":"none";
document.getElementById("tab-"+t).classList.toggle("active",t===tab);
});
if(tab==="saved") renderSaved();
if(tab==="lists") renderLists();
}

document.getElementById("activityPct").oninput=function(){
document.getElementById("pctLabel").innerText=this.value+"%";
}
document.getElementById("batchDays").oninput=function(){
document.getElementById("batchLabel").innerText=this.value+" days";
}
</script>
</body>
</html>
