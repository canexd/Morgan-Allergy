<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Pet Peeves ‚Äì Morgan</title>

<style>
:root{
  --bg:#0b1424;
  --panel:#121f35;
  --panel2:#0f1b2f;
  --ink:#eaf1ff;
  --muted:rgba(234,241,255,.78);
  --muted2:rgba(234,241,255,.60);
  --line:rgba(255,255,255,.08);

  --blue:#2f6df6;
  --purple:#8a5cff;

  --good:#5cffad;
  --bad:#ff6b6b;
  --caution:#ffd166;

  --shadow:0 16px 44px rgba(0,0,0,.34);
  --radius:18px;
  --radius2:14px;
  --mono: ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,monospace;
}

*{box-sizing:border-box}
body{
  margin:0;
  padding:18px;
  background: radial-gradient(1200px 800px at 20% 0%, rgba(47,109,246,.18), transparent 55%),
              radial-gradient(1200px 800px at 80% 10%, rgba(138,92,255,.14), transparent 55%),
              var(--bg);
  color:var(--ink);
  font-family: system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
}

.wrap{max-width:980px;margin:0 auto}

.hero{
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:14px;
  margin:10px 0 14px;
  padding:14px;
  border:1px solid var(--line);
  background:linear-gradient(180deg,rgba(255,255,255,.04),rgba(255,255,255,.02));
  border-radius:var(--radius);
  box-shadow:var(--shadow);
}
.hero h1{margin:0;font-size:18px}
.hero .sub{font-size:13px;color:var(--muted)}

.tabs{
  display:flex;
  gap:10px;
  flex-wrap:wrap;
  justify-content:center;
  margin:14px 0 18px;
}
.tabBtn{
  border:none;
  cursor:pointer;
  padding:11px 14px;
  border-radius:999px;
  font-weight:800;
  color:var(--ink);
  background:rgba(255,255,255,.05);
  border:1px solid var(--line);
}
.tabBtn.active{
  background:linear-gradient(180deg,rgba(47,109,246,.45),rgba(47,109,246,.22));
  border-color:rgba(47,109,246,.45);
}

.card{
  background:linear-gradient(180deg,rgba(255,255,255,.045),rgba(255,255,255,.02));
  border:1px solid var(--line);
  border-radius:var(--radius);
  padding:16px;
  box-shadow:var(--shadow);
  margin-bottom:16px;
}
.card h2{margin:0 0 10px;font-size:16px}

textarea,input,select{
  width:100%;
  padding:12px;
  border-radius:14px;
  border:1px solid var(--line);
  background:rgba(10,18,32,.65);
  color:var(--ink);
  font-size:16px;
}

textarea{min-height:122px}

.btnRow{display:flex;gap:10px;flex-wrap:wrap;margin-top:10px}
.btn{
  border:none;
  cursor:pointer;
  padding:11px 14px;
  border-radius:14px;
  font-weight:900;
  color:var(--ink);
  background:rgba(255,255,255,.06);
  border:1px solid var(--line);
}
.btn.primary{
  background:linear-gradient(180deg,rgba(47,109,246,.55),rgba(47,109,246,.25));
  border-color:rgba(47,109,246,.45);
}

.result{
  margin-top:12px;
  padding:12px;
  border-radius:var(--radius2);
  border:1px solid var(--line);
  background:rgba(8,14,26,.60);
}

.pill{
  display:inline-block;
  padding:6px 10px;
  border-radius:999px;
  font-size:12px;
  font-weight:900;
  border:1px solid var(--line);
}

.pill.good{color:var(--good)}
.pill.bad{color:var(--bad)}
.pill.caution{color:var(--caution)}

.muted{color:var(--muted);font-size:13px}
.mono{font-family:var(--mono)}
.divider{height:1px;background:var(--line);margin:12px 0}
</style>
</head>
<body>

<div class="wrap">
<div class="hero">
<div>
<h1>üêæ Pet Peeves ‚Äî Morgan</h1>
<div class="sub">
Ultra Smart Scanner ‚Ä¢ Additives + Food ‚Ä¢ Meal Planner ‚Ä¢ Saved Meals ‚Ä¢ OCR-safe
</div>
</div>
</div>

<div class="tabs">
<button class="tabBtn active" id="tab-scanner" onclick="showTab('scanner')">Scanner</button>
<button class="tabBtn" id="tab-meal" onclick="showTab('meal')">Meal Planner</button>
<button class="tabBtn" id="tab-saved" onclick="showTab('saved')">Saved Meals</button>
</div>

<!-- SCANNER -->
<div id="scanner" class="card">
<h2>üîç Scanner</h2>
<div class="muted">
Paste ingredients (comma or line separated). Food + Additives scanned together.
Handles plurals, OCR parentheses, and parent keyword breakdown.
</div>

<textarea id="scanInput" placeholder="Example:
Ingredients: apples, calcium carbonate (to preserve color)
Chicken
Rice
Yogurt
E 221 sodium sulphite"></textarea>

<div class="btnRow">
<button class="btn primary" onclick="scanAll()">Scan</button>
<button class="btn" onclick="demoScan()">Demo</button>
<button class="btn" onclick="clearScan()">Clear</button>
</div>

<div id="scanResults"></div>

<details style="margin-top:12px">
<summary><b>üì∏ Photo ‚Üí Text Tips</b></summary>
<div class="muted" style="margin-top:6px">
iPhone: Take photo ‚Üí tap Live Text ‚Üí copy ‚Üí paste here.<br><br>
Parentheses like <span class="mono">calcium carbonate (freshness)</span> are ignored for matching.<br>
Plural-safe: carrots ‚Üí carrot. noodles ‚Üí noodle.
</div>
</details>

</div>
<!-- MEAL PLANNER -->
<div id="meal" class="card" style="display:none">
<h2>üç≤ Meal Planner</h2>
<div class="muted">
Generates meals from dog-safe foods, then filters out anything listed as Moderate or High for Morgan.
US units only: lbs / oz / cups / fl oz.
</div>

<label>Morgan weight (lbs)</label>
<input id="morganWeight" type="number" value="55" min="1" step="1">

<label>Activity level</label>
<select id="activity">
<option value="2.0">Sedentary (2%)</option>
<option value="2.5" selected>Normal (2.5%)</option>
<option value="3.0">Active (3%)</option>
<option value="3.5">Very Active (3.5%)</option>
<option value="4.0">Working (4%)</option>
</select>

<label>Meals per day</label>
<select id="mealsPerDay">
<option value="1">1</option>
<option value="2" selected>2</option>
<option value="3">3</option>
</select>

<label>Batch days (1‚Äì7)</label>
<input id="batchDays" type="range" min="1" max="7" value="7">
<div class="muted"><span id="batchLabel">7 days</span></div>

<label>Liquid display</label>
<select id="liquidUnit">
<option value="fl_oz" selected>fl oz</option>
<option value="cups">cups</option>
</select>

<div class="btnRow">
<button class="btn primary" onclick="generateMeal()">Generate Meal</button>
<button class="btn" onclick="saveMeal()">Save Meal</button>
<button class="btn" onclick="exportGrocery()">Export Grocery</button>
</div>

<div id="mealOutput"></div>
</div>

<!-- SAVED -->
<div id="saved" class="card" style="display:none">
<h2>üíæ Saved Meals</h2>
<div id="savedMeals"></div>
</div>

<script>

/* =========================================================
   MORGAN REACTIVITY DATA
========================================================= */

const MORGAN = {
food:{
high:[
"bacon","carrot","cheese - cheddar","cheese - cottage","durian",
"fermented pork","flaxseed","ginkgo biloba","mackerel","milk - cow",
"ocean fish meal","pepper - green","pig skin","pine nut","pork",
"pork fat","pork heart","pork kidney","pork liver","pork skins",
"pork tongue","soy flour","tofu","yogurt (plain)"
],
moderate:[
"alfalfa nutrient concentrate","anchovy","brussels sprouts","chestnut",
"chokeberry (aronia berry)","coconut","cranberries","cream","elk",
"figs","grapefruit","grouse","okra","olive oil","pepper - white",
"pig trotters","rice (white)","roe - deer","salmon",
"scarlet runner bean","teff (vegan)","trout","turkey heart"
]
},
additives:{
high:[
"e 129 allura red","e 170 calcium carbonate","e 172 iron oxides",
"e 234 nisin","e 304 ascorbyl palmitate","e 463 hydroxypropyl cellulose",
"e 472 d tartaric acid esters","e 475 polyglycerol esters",
"e 512 stannous chloride","e 629 calcium guanylate",
"e 938 argon","e 941 nitrogen","formalin"
],
moderate:[
"e 110 sunset yellow","e 151 brilliant black","e 203 calcium sorbate",
"e 221 sodium sulphite","e 233 thiabendazole","e 326 potassium lactate",
"e 336 potassium tartrate","e 338 phosphoric acid","e 460 cellulose",
"e 495 sorbitan monopalmitate","e 514 sodium sulphate",
"e 541 sodium aluminium phosphate","e 585 ferrous lactate",
"e 952 cyclamic acid","e 953 isomalt","e 966 lactitol",
"polyethylene glycol"
]
}
};

/* =========================================================
   SMART NORMALIZATION ENGINE
========================================================= */

function norm(s){
return (s||"")
.toLowerCase()
.replace(/\(.*?\)/g,"")
.replace(/ingredients\s*:/gi,"")
.replace(/[^a-z0-9\s\-]/g," ")
.replace(/\s+/g," ")
.trim();
}

function singularize(w){
if(w.endsWith("ies")) return w.slice(0,-3)+"y";
if(w.endsWith("s") && !w.endsWith("ss")) return w.slice(0,-1);
return w;
}

function keyify(s){
return norm(s)
.split(" ")
.map(singularize)
.join(" ");
}

/* =========================================================
   PARENT KEYWORDS
========================================================= */

const PARENTS={
rice:["rice (white)","rice (brown)"],
yogurt:["yogurt (plain)"],
pepper:["pepper - green","pepper - white"]
};

/* =========================================================
   MATCHING
========================================================= */

function getSeverity(term){
const k=keyify(term);

if(MORGAN.food.high.map(keyify).includes(k)) return "High";
if(MORGAN.food.moderate.map(keyify).includes(k)) return "Moderate";
if(MORGAN.additives.high.map(keyify).includes(k)) return "High";
if(MORGAN.additives.moderate.map(keyify).includes(k)) return "Moderate";

return null;
}

function containsParent(term){
const k=keyify(term);
for(const p in PARENTS){
if(k===p) return p;
}
return null;
}

/* =========================================================
   SCANNER
========================================================= */

function renderResult(item){
const sev=getSeverity(item);
const parent=containsParent(item);

if(parent){
let breakdown="";
PARENTS[parent].forEach(v=>{
const s=getSeverity(v);
breakdown+=`<div>${v} ‚Äî ${s?`<span class="pill ${s==="High"?"bad":"caution"}">${s}</span>`:`<span class="pill good">OK</span>`}</div>`;
});
return `
<div class="result">
<b>${item}</b>
<div class="pill caution">CAUTION</div>
<div class="divider"></div>
${breakdown}
</div>`;
}

if(sev){
return `
<div class="result">
<b>${item}</b>
<div class="pill ${sev==="High"?"bad":"caution"}">${sev} ‚Äî NOT SAFE for Morgan</div>
</div>`;
}

return `
<div class="result">
<b>${item}</b>
<div class="pill good">SAFE</div>
</div>`;
}

function scanAll(){
const raw=document.getElementById("scanInput").value;
const items=raw.split(/[\n,]+/).map(x=>x.trim()).filter(Boolean);

if(items.length===0){
document.getElementById("scanResults").innerHTML="<div class='muted'>Paste ingredients first.</div>";
return;
}

let html="";
items.forEach(i=>html+=renderResult(i));
document.getElementById("scanResults").innerHTML=html;
}

function demoScan(){
document.getElementById("scanInput").value=`Chicken
Carrot
Rice
Yogurt
E 221 sodium sulphite`;
scanAll();
}

function clearScan(){
document.getElementById("scanInput").value="";
document.getElementById("scanResults").innerHTML="";
}
  /* =========================================================
   SAFE FOOD LIBRARY (Filtered by Morgan Lists)
========================================================= */

const LIB = {
proteins:["chicken","turkey","duck","lamb","bison","venison","beef","sardine"],
carbs:["rice (brown)","oats","barley","quinoa","pumpkin","sweet potato"],
veg:["zucchini","green beans","spinach","broccoli","peas","cucumber"],
fats:["fish oil","salmon oil","sunflower oil"],
boost:["pumpkin puree","bone broth","blueberries","apple","parsley"]
};

function isBanned(item){
const k=keyify(item);
return MORGAN.food.high.map(keyify).includes(k)
|| MORGAN.food.moderate.map(keyify).includes(k);
}

function safePool(arr){
return arr.filter(x=>!isBanned(x));
}

function pickRandom(arr){
return arr[Math.floor(Math.random()*arr.length)];
}

/* =========================================================
   UNIT HELPERS
========================================================= */

function lbsToOz(lbs){return lbs*16;}

function fmtLbsOz(totalOz){
const lbs=Math.floor(totalOz/16);
const oz=(totalOz-lbs*16).toFixed(1).replace(/\.0$/,"");
if(lbs<=0) return `${oz} oz`;
return `${lbs} lb ${oz} oz`;
}

function fmtCups(oz){
return (oz/4).toFixed(2).replace(/0+$/,"").replace(/\.$/,"")+" cups";
}

function fmtLiquid(oz){
const unit=document.getElementById("liquidUnit").value;
if(unit==="cups") return fmtCups(oz);
return oz.toFixed(1).replace(/\.0$/,"")+" fl oz";
}

/* =========================================================
   MEAL GENERATION
========================================================= */

let LAST_MEAL=null;

function generateMeal(){

const lbs=parseFloat(document.getElementById("morganWeight").value||"0");
const pct=parseFloat(document.getElementById("activity").value||"2.5")/100;
const meals=parseInt(document.getElementById("mealsPerDay").value||"2",10);
const days=parseInt(document.getElementById("batchDays").value||"7",10);

if(!lbs){
document.getElementById("mealOutput").innerHTML="<div class='result'>Enter Morgan‚Äôs weight.</div>";
return;
}

const dailyOz=lbsToOz(lbs*pct);
const perMealOz=dailyOz/meals;
const batchTotalOz=dailyOz*days;

const protein=pickRandom(safePool(LIB.proteins));
const carb=pickRandom(safePool(LIB.carbs));
const veg=pickRandom(safePool(LIB.veg));
const fat=pickRandom(safePool(LIB.fats));
const boost=pickRandom(safePool(LIB.boost));

const proteinOz=batchTotalOz*0.5;
const carbOz=batchTotalOz*0.2;
const vegOz=batchTotalOz*0.15;
const fatOz=batchTotalOz*0.05;
const boostOz=batchTotalOz*0.1;

LAST_MEAL={
protein,carb,veg,fat,boost,
dailyOz,perMealOz,batchTotalOz,
proteinOz,carbOz,vegOz,fatOz,boostOz,
days,meals
};

document.getElementById("mealOutput").innerHTML=`
<div class="divider"></div>
<div class="result">
<b>Meal Suggestion (Morgan Safe Filter)</b>
<div class="divider"></div>

<div><b>Protein:</b> ${protein}</div>
<div><b>Carb:</b> ${carb}</div>
<div><b>Veg:</b> ${veg}</div>
<div><b>Fat:</b> ${fat}</div>
<div><b>Flavor:</b> ${boost}</div>

<div class="divider"></div>

<b>Feeding</b><br>
Morgan daily: ${fmtLbsOz(dailyOz)} (~${fmtCups(dailyOz)})<br>
Morgan per meal: ${fmtLbsOz(perMealOz)} (~${fmtCups(perMealOz)})

<div class="divider"></div>

<b>Batch (${days} days)</b><br>
Total: ${fmtLbsOz(batchTotalOz)} (~${fmtCups(batchTotalOz)})

<div class="divider"></div>

<b>Grocery Breakdown</b>
<div class="mono">
${protein}: ${fmtLbsOz(proteinOz)}
${carb}: ${fmtLbsOz(carbOz)}
${veg}: ${fmtLbsOz(vegOz)}
${fat}: ${fmtLbsOz(fatOz)}
${boost}: ${fmtLbsOz(boostOz)} (‚âà ${fmtLiquid(boostOz)})
</div>

<div class="divider"></div>

<b>Cooking Instructions</b>
<div class="mono">
1) Cook protein fully. No seasoning.
2) Cook carb plain in water.
3) Steam vegetables.
4) Let cool completely.
5) Mix together.
6) Add oils after cooling.
7) Portion daily servings.
8) Refrigerate 3‚Äì4 days. Freeze remainder.
</div>
</div>`;
}

/* =========================================================
   SAVE + EXPORT
========================================================= */

const LS_KEY="morgan_saved_meals";

function saveMeal(){
if(!LAST_MEAL){alert("Generate meal first.");return;}
const saved=JSON.parse(localStorage.getItem(LS_KEY)||"[]");
saved.unshift(LAST_MEAL);
localStorage.setItem(LS_KEY,JSON.stringify(saved));
renderSaved();
alert("Saved ‚úÖ");
}

function renderSaved(){
const saved=JSON.parse(localStorage.getItem(LS_KEY)||"[]");
if(saved.length===0){
document.getElementById("savedMeals").innerHTML="<div class='muted'>No saved meals yet.</div>";
return;
}
let html="";
saved.forEach((m,i)=>{
html+=`
<div class="result">
<b>${m.protein} + ${m.carb} + ${m.veg}</b>
<div class="mono">${fmtLbsOz(m.batchTotalOz)}</div>
<button onclick="deleteMeal(${i})">Delete</button>
</div>`;
});
document.getElementById("savedMeals").innerHTML=html;
}

function deleteMeal(i){
const saved=JSON.parse(localStorage.getItem(LS_KEY)||"[]");
saved.splice(i,1);
localStorage.setItem(LS_KEY,JSON.stringify(saved));
renderSaved();
}

function exportGrocery(){
if(!LAST_MEAL){alert("Generate meal first.");return;}
const m=LAST_MEAL;

const text=
`Morgan Grocery List

Batch: ${m.days} days
Meals/day: ${m.meals}

INGREDIENTS
${m.protein}: ${fmtLbsOz(m.proteinOz)}
${m.carb}: ${fmtLbsOz(m.carbOz)}
${m.veg}: ${fmtLbsOz(m.vegOz)}
${m.fat}: ${fmtLbsOz(m.fatOz)}
${m.boost}: ${fmtLbsOz(m.boostOz)} (‚âà ${fmtLiquid(m.boostOz)})

FEEDING
Daily: ${fmtLbsOz(m.dailyOz)} (~${fmtCups(m.dailyOz)})
Per Meal: ${fmtLbsOz(m.perMealOz)} (~${fmtCups(m.perMealOz)})
`;

navigator.clipboard.writeText(text).then(()=>alert("Copied grocery list ‚úÖ"));
}

/* =========================================================
   TAB LOGIC
========================================================= */

function showTab(tab){
["scanner","meal","saved"].forEach(t=>{
document.getElementById(t).style.display=(t===tab)?"block":"none";
document.getElementById("tab-"+t).classList.toggle("active",t===tab);
});
if(tab==="saved") renderSaved();
}

document.getElementById("batchDays").addEventListener("input",e=>{
document.getElementById("batchLabel").innerText=e.target.value+" days";
});

/* =========================================================
   INIT
========================================================= */

renderSaved();

</script>
</body>
</html>
